<!DOCTYPE html>
<html lang="en" ng-app="trainApp">
<head>
  <meta charset="UTF-8">
  <title>Train Management System</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #f5f7fa;
    }

    h2 {
      text-align: center;
      color: #1a237e;
      margin-bottom: 25px;
    }

    .form-section {
      background: #ffffff;
      border: 1px solid #cfd8dc;
      padding: 20px;
      border-radius: 6px;
      margin-bottom: 25px;
    }

    label {
      font-weight: bold;
      color: #37474f;
      display: block;
      margin-bottom: 5px;
    }

    input, select {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 12px;
      border: 1px solid #b0bec5;
      border-radius: 4px;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #1e88e5;
      box-shadow: 0 0 3px #64b5f6;
    }

    button {
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      margin-right: 5px;
    }

    .btn-add { background-color: #1e88e5; color: white; }
    .btn-reset { background-color: #fbc02d; color: black; }
    .btn-edit { background-color: #43a047; color: white; }
    .btn-delete { background-color: #e53935; color: white; }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      border: 1px solid #cfd8dc;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #cfd8dc;
    }

    th {
      background-color: #1565c0;
      color: white;
    }

    tr:hover {
      background-color: #e3f2fd;
    }

    .action-buttons button {
      margin: 2px;
      font-size: 13px;
    }
  </style>
</head>

<body ng-controller="trainCtrl" ng-init="display()">

  <h2>Train Management System</h2>

  <!-- Add / Update Train Form -->
  <div class="form-section">
    <label>Train Number</label>
    <input type="text" ng-model="train_no">

    <label>Train Name</label>
    <input type="text" ng-model="train_name">

    <label>Source</label>
    <input type="text" ng-model="source">

    <label>Destination</label>
    <input type="text" ng-model="destination">

    <label>Departure Time</label>
    <input type="text" ng-model="departure" placeholder="HH:MM">

    <label>Arrival Time</label>
    <input type="text" ng-model="arrival" placeholder="HH:MM">

    <label>Status</label>
    <select ng-model="status">
      <option value="">Select Status</option>
      <option>On Time</option>
      <option>Delayed</option>
      <option>Cancelled</option>
    </select>

    <button class="btn-add" ng-click="insert()">{{btnname}}</button>
    <button class="btn-reset" ng-click="reset()">Reset</button>
  </div>

  <!-- Display Table -->
  <table>
    <tr>
      <th>Sr</th>
      <th>ID</th>
      <th>Train No</th>
      <th>Train Name</th>
      <th>Source</th>
      <th>Destination</th>
      <th>Departure</th>
      <th>Arrival</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    <tr ng-repeat="t in trains">
      <td>{{$index + 1}}</td>
      <td>{{t.id}}</td>
      <td>{{t.train_no}}</td>
      <td>{{t.train_name}}</td>
      <td>{{t.source}}</td>
      <td>{{t.destination}}</td>
      <td>{{t.departure}}</td>
      <td>{{t.arrival}}</td>
      <td>{{t.status}}</td>
      <td class="action-buttons">
        <button class="btn-edit" ng-click="edit(t)">Edit</button>
        <button class="btn-delete" ng-click="delete(t.id)">Delete</button>
      </td>
    </tr>
  </table>

  <script>
    var app = angular.module("trainApp", []);
    app.controller("trainCtrl", function($scope, $http) {
      $scope.btnname = "Add";

      $scope.insert = function() {
        if (!$scope.train_no || !$scope.train_name || !$scope.source || !$scope.destination ||
            !$scope.departure || !$scope.arrival || !$scope.status) {
          alert("Please fill all fields");
          return;
        }

        $http.post("insert.php", {
          'train_no': $scope.train_no,
          'train_name': $scope.train_name,
          'source': $scope.source,
          'destination': $scope.destination,
          'departure': $scope.departure,
          'arrival': $scope.arrival,
          'status': $scope.status,
          'btnname': $scope.btnname,
          'id': $scope.id
        }).success(function(data) {
          alert(data);
          $scope.reset();
          $scope.display();
        });
      };

      $scope.display = function() {
        $http.get("display.php").success(function(data) {
          $scope.trains = data.records;
        });
      };

      $scope.edit = function(t) {
        $scope.train_no = t.train_no;
        $scope.train_name = t.train_name;
        $scope.source = t.source;
        $scope.destination = t.destination;
        $scope.departure = t.departure;
        $scope.arrival = t.arrival;
        $scope.status = t.status;
        $scope.id = t.id;
        $scope.btnname = "Update";
      };

      $scope.delete = function(id) {
        if (confirm("Are you sure you want to delete this train?")) {
          $http.post("delete.php", {'id': id}).success(function(data) {
            alert("Train deleted successfully!");
            $scope.display();
          });
        }
      };

      $scope.reset = function() {
        $scope.train_no = "";
        $scope.train_name = "";
        $scope.source = "";
        $scope.destination = "";
        $scope.departure = "";
        $scope.arrival = "";
        $scope.status = "";
        $scope.id = "";
        $scope.btnname = "Add";
      };
    });
  </script>
</body>
</html>
